---
export const prerender = true;

import Layout from '@/layouts/LayoutBase.astro';
import { slugify } from '@/utils/slugify.js';
import { getCollection } from 'astro:content';

const title = "–ú–∞–∫–µ—Ç 1: –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏";
const description = "–¢–µ–≥–∏, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ —Å–º—ã—Å–ª–æ–≤—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º";

const posts = await getCollection('blog', (post) => {
    return !post.data.isDraft && post.data.date <= new Date();
});

// Count tags
const tagCounts = new Map<string, number>();
posts.forEach((post) => {
    post.data.tags?.forEach((tag) => {
        const tagStr = tag.toString();
        tagCounts.set(tagStr, (tagCounts.get(tagStr) || 0) + 1);
    });
});

// Define semantic categories with patterns and manual assignments
const categories = {
    curated: {
        title: "–ö—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏",
        emoji: "‚≠ê",
        description: "–õ—É—á—à–µ–µ –¥–ª—è –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞–Ω–∏—è",
        tags: ["–∏–∑–±—Ä–∞–Ω–Ω–æ–µ", "–ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–µ", "–ª—é–±–∏–º–æ–µ", "–æ —Ö–æ—Ä–æ—à–µ–º"]
    },
    contentType: {
        title: "–¢–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞",
        emoji: "üìö",
        description: "–§–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Å–∏",
        patterns: ["–∫–∞—Ä—Ç–∏–Ω–∫–∏", "—Ü–∏—Ç–∞—Ç—ã", "—Ç–≤–∏—Ç—ã", "—Å—Å—ã–ª–∫–∏", "–∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏", "–≤–∏–¥–µ–æ", "–∫–æ–º–∏–∫—Å—ã", "—Ç–µ–∫—Å—Ç—ã –¥–ª—è —á—Ç–µ–Ω–∏—è", "–¥–∏–∞–ª–æ–≥–∏", "—Å–ø–∏—Å–∫–∏", "–≥—Ä–∞—Ñ–∏–∫–∏ –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã", "—Å–∫—Ä–∏–Ω—à–æ—Ç—ã", "–∞–≤—Ç–æ–ø–æ—Ä—Ç—Ä–µ—Ç—ã"]
    },
    topics: {
        title: "–¢–µ–º–∞—Ç–∏–∫–∞",
        emoji: "üí≠",
        description: "–û —á—ë–º —ç—Ç–æ",
        patterns: ["–ø—Ä–æ "]
    },
    people: {
        title: "–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∏",
        emoji: "üë§",
        description: "–õ—é–¥–∏, –∞–≤—Ç–æ—Ä—ã, –ø–µ—Ä—Å–æ–Ω–∞–∂–∏",
        patterns: ["–í–æ–ª–æ–±—É–µ–≤", "–ì–∏–±—Å–æ–Ω", "–ù–∏–ª –ì–µ–π–º–∞–Ω", "–ú–∏—Ç—á–µ–ª–ª", "–ì–æ—Ä–∞–ª–∏–∫", "–°—Ç–∏–≤ –î–∂–æ–±—Å", "–ê—Ñ–∏—à–∞", "–ú–µ–¥—É–∑–∞", "–î–∞–Ω–∏–ª–∫–∏–Ω", "–ü–æ–¥—à–∏–±—è–∫–∏–Ω", "–°–∞–ø—Ä—ã–∫–∏–Ω", "–ó–µ–ª—å–≤–µ–Ω—Å–∫–∏–π", "–û–ª–µ—Å—è", "–ì—Ä–∏–≥–æ—Ä–∏–π –û—Å—Ç–µ—Ä", "–•–∞—Ä—É–∫–∏ –ú—É—Ä–∞–∫–∞–º–∏", "–°–µ—Ç –ì–æ–¥–∏–Ω", "–ö–æ—Ä–∏ –î–æ–∫—Ç–æ—Ä–æ–≤", "–î—É–≥–ª–∞—Å –ê–¥–∞–º—Å", "–ù–∏–ª –°—Ç–∏–≤–µ–Ω—Å–æ–Ω", "–ú–∞–∫—Å –§—Ä–∞–π", "Russell Davies", "Paul Ford", "Clive Thompson", "–ö–∞—Ä–ª –í–∏—Ç–∞–∫–µ—Ä"]
    },
    series: {
        title: "–†—É–±—Ä–∏–∫–∏ –∏ —Å–µ—Ä–∏–∏",
        emoji: "üìñ",
        description: "–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ñ–æ—Ä–º–∞—Ç—ã",
        patterns: ["–±–µ–∑–∂–∞–ª–æ—Å—Ç–Ω—ã–π –ø–æ—Å—Ç–º–æ–¥–µ—Ä–Ω–∏–∑–º", "—Ä–æ—Å–∫–æ—à—å —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –æ–±—â–µ–Ω–∏—è", "—É–¥–∏–≤–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç—ã", "–≤–∫—É—Å—ã –≤ —Ü–∏—Ñ—Ä–∞—Ö", "–ø—Ä–∞–≤–∏–ª–∞ –∂–∏–∑–Ω–∏ —Å–æ—Ü–∏–æ–ø–∞—Ç–∞", "–≥–æ–≤–æ—Ä—è—â–∏–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã", "–≤—Å—è –∂–∏–∑–Ω—å –∏–≥—Ä–∞", "–±—É–¥—É—â–µ–µ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ", "–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ä–≥–∞–∑–º", "—É–ø—Ä–æ—â–µ–Ω–∏–µ —Å—Ç—Ä–æ–ø—Ç–∏–≤–æ–π", "–¥–µ–ª–æ –Ω–µ –≤ –¥–µ–Ω—å–≥–∞—Ö", "–∂–µ–Ω—â–∏–Ω—ã –∏ –ª—é–¥–∏", "—Å—Ö–≤–∞—Ç–∏–ª –∑–∞ –º–æ–∑–≥", "–ª–µ–≥–∏–æ–Ω —Ç–∞–π–Ω—ã—Ö –ø–æ–∫–ª–æ–Ω–Ω–∏—Ü", "–º–æ–π –¥–æ–º–∞—à–Ω–∏–π –±–∞—à–æ—Ä–≥", "—Å–ª–æ–≤–æ –¥–Ω—è", "—Ç–æ–ø–æ–ª–æ–≥–∏—è –æ–≤—Ü—ã"]
    },
    aesthetic: {
        title: "–≠—Å—Ç–µ—Ç–∏–∫–∞ –∏ –≤–∏–∑—É–∞–ª",
        emoji: "üé®",
        description: "–í–∏–∑—É–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",
        patterns: ["–¥–µ–≤—É—à–∫–∏", "—á–±", "–≥–ª–∞–∑–∞", "–Ω–æ–≥–∏", "—Ä—É–∫–∏", "–∫–æ–ª–µ–Ω–∫–∏", "–∫–∞–±–ª—É–∫–∏", "—á—É–ª–∫–∏", "–≤–µ—Å–Ω—É—à–∫–∏", "–±–ª–æ–Ω–¥–∏–Ω–∫–∏", "—Ä—ã–∂–∏–µ", "–ø–æ—Ä–Ω–æ", "–ø–æ—Ä–Ω—Ç—Ä–µ—Ç—ã", "–º-–º-–º... –≥—Ä—É–¥—å", "–ø–æ–ª–æ—Å–∫–∏"]
    },
    mood: {
        title: "–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è",
        emoji: "üåô",
        description: "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ–≥–∏",
        patterns: ["–º–∏–∑–∞–Ω—Ç—Ä–æ–ø–∏—è", "–º–∞–Ω—Ç—Ä—ã", "—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∫—É–ª—å—Ç—É—Ä–∞", "—Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–π", "–∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ", "–Ω–∞—Ä—Ä–∞—Ç–∏–≤", "–≥–∏–ø–µ—Ä—Ç–µ–∫—Å—Ç", "—Ç–µ—Ä–ø–µ–Ω—å–µ –∏ —Ç—Ä—É–¥", "–≤–µ–ª–∏–∫–∏–µ –ª—é–¥–∏"]
    },
    platforms: {
        title: "–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏",
        emoji: "üîó",
        description: "–û—Ç–∫—É–¥–∞ —ç—Ç–æ –ø—Ä–∏—à–ª–æ",
        patterns: ["formspring.me", "bash", "tumblr", "–∏–Ω—Å—Ç–∞–≥—Ä–∞–º", "—Ç–≤–∏—Ç—Ç–µ—Ä", "xkcd", "House MD", "–ó–≤—ë–∑–¥–Ω—ã–µ –≤–æ–π–Ω—ã", "–õ–æ—Å—Ç", "Apple", "Google", "Amazon", "Wired", "The Onion", "37signals", "Team Fortress 2"]
    },
    life: {
        title: "–ñ–∏–∑–Ω—å –∏ –±—ã—Ç",
        emoji: "üè†",
        description: "–ü–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–µ",
        patterns: ["–∂–∏–≤–æ–π —É–≥–æ–ª–æ–∫", "–∫–æ—à–∫–∏", "–æ–≤—Ü—ã", "–ø–∞–Ω–¥—ã", "–∫—Ä–æ–ª–∏–∫–∏", "–≥–æ—Ä–æ–¥–∞ –∏ –ª—é–¥–∏", "–∏ –æ –ø–æ–≥–æ–¥–µ", "—ç—Ç–æ —Ä–æ–¥–∏–Ω–∞ –º–æ—è", "–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ ‚Äî –¥–µ—Ç–∏", "–æ –≤–∫—É—Å–Ω–æ–π –∏ –∑–¥–æ—Ä–æ–≤–æ–π –ø–∏—â–µ", "–ø–µ—Å–Ω–∏ –∏ –ø–ª—è—Å–∫–∏", "–µ–∑–¥–∏—Ç –∏ –ª–µ—Ç–∞–µ—Ç", "–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞", "–ú–æ—Å–∫–≤–∞", "–ü–µ—Ç–µ—Ä–±—É—Ä–≥"]
    }
};

// Get all tags
const allTags = [...tagCounts.keys()].sort();

// Categorize tags
const categorizedTags: Record<string, string[]> = {};
const usedTags = new Set<string>();

Object.entries(categories).forEach(([key, cat]) => {
    categorizedTags[key] = [];

    // Manual tags
    if ('tags' in cat) {
        cat.tags.forEach(tag => {
            if (tagCounts.has(tag)) {
                categorizedTags[key].push(tag);
                usedTags.add(tag);
            }
        });
    }

    // Pattern matching
    if ('patterns' in cat) {
        allTags.forEach(tag => {
            if (usedTags.has(tag)) return;
            const matches = cat.patterns.some(p =>
                tag.toLowerCase().includes(p.toLowerCase()) ||
                tag === p
            );
            if (matches) {
                categorizedTags[key].push(tag);
                usedTags.add(tag);
            }
        });
    }

    // Sort by count
    categorizedTags[key].sort((a, b) => (tagCounts.get(b) || 0) - (tagCounts.get(a) || 0));
});

// Uncategorized tags
const uncategorizedTags = allTags.filter(t => !usedTags.has(t))
    .sort((a, b) => (tagCounts.get(b) || 0) - (tagCounts.get(a) || 0));
---

<Layout title={title} description={description}>
    <article class="prose categories-layout">
        <header class="page-header">
            <h1>–¢–µ–≥–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h1>
            <p class="subtitle">–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ç–µ–≥–æ–≤ –±–ª–æ–≥–∞</p>
            <p class="meta">–í—Å–µ–≥–æ —Ç–µ–≥–æ–≤: {allTags.length} ¬∑ <a href="/tags-analysis/">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∞–Ω–∞–ª–∏–∑—É</a></p>
        </header>

        <div class="categories-grid">
            {Object.entries(categories).map(([key, cat]) => (
                <section class="category-section">
                    <h2>
                        <span class="emoji">{cat.emoji}</span>
                        {cat.title}
                    </h2>
                    <p class="category-desc">{cat.description}</p>
                    <ul class="tag-list">
                        {categorizedTags[key].map((tag) => (
                            <li class="tag-item">
                                <a href={`/tagged/${slugify(tag)}/`}>
                                    {tag}
                                    <span class="count">{tagCounts.get(tag)}</span>
                                </a>
                            </li>
                        ))}
                    </ul>
                </section>
            ))}
        </div>

        <section class="category-section other-section">
            <h2>
                <span class="emoji">üìÅ</span>
                –ü—Ä–æ—á–∏–µ —Ç–µ–≥–∏
            </h2>
            <p class="category-desc">–¢–µ–≥–∏ –±–µ–∑ —è–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ({uncategorizedTags.length})</p>
            <ul class="tag-list compact">
                {uncategorizedTags.map((tag) => (
                    <li class="tag-item">
                        <a href={`/tagged/${slugify(tag)}/`}>
                            {tag}
                            <span class="count">{tagCounts.get(tag)}</span>
                        </a>
                    </li>
                ))}
            </ul>
        </section>
    </article>
</Layout>

<style>
    .categories-layout {
        max-width: 900px;
        margin: 0 auto;
    }

    .page-header {
        text-align: center;
        margin-bottom: var(--spacing-3xl);
    }

    .page-header h1 {
        margin-bottom: var(--spacing-xs);
    }

    .subtitle {
        color: var(--color-grey-500);
        font-style: italic;
        margin-bottom: var(--spacing-sm);
    }

    .meta {
        font-size: var(--font-size-xs);
        color: var(--color-grey-400);
    }

    .categories-grid {
        display: grid;
        gap: var(--spacing-2xl);
    }

    @media (min-width: 600px) {
        .categories-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    .category-section {
        padding: var(--spacing-lg);
        background: var(--color-grey-50);
        border-radius: 8px;
        border-left: 4px solid var(--theme-color-base);
    }

    .category-section h2 {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        margin: 0 0 var(--spacing-xs) 0;
        font-size: var(--font-size-base);
        color: var(--theme-color-base);
    }

    .emoji {
        font-size: var(--font-size-lg);
    }

    .category-desc {
        font-size: var(--font-size-xs);
        color: var(--color-grey-500);
        margin: 0 0 var(--spacing-md) 0;
        font-style: italic;
    }

    .tag-list {
        display: flex;
        flex-wrap: wrap;
        gap: var(--spacing-sm);
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .tag-list.compact {
        gap: var(--spacing-xs) var(--spacing-sm);
    }

    .tag-item {
        margin: 0;
    }

    .tag-item a {
        display: inline-flex;
        align-items: center;
        gap: var(--spacing-xs);
        padding: 4px 10px;
        background: var(--color-white);
        border: 1px solid var(--color-grey-200);
        border-radius: 16px;
        font-size: var(--font-size-xs);
        color: var(--color-grey-700);
        text-decoration: none;
        transition: all 0.2s ease;
    }

    .tag-item a:hover {
        background: var(--color-blue-100);
        border-color: var(--theme-color-base);
        color: var(--theme-color-base);
    }

    .count {
        font-size: 0.7rem;
        color: var(--color-grey-400);
        background: var(--color-grey-100);
        padding: 1px 5px;
        border-radius: 10px;
    }

    .other-section {
        grid-column: 1 / -1;
        background: var(--color-white);
        border: 1px dashed var(--color-grey-300);
        border-left: 4px solid var(--color-grey-300);
    }

    .compact .tag-item a {
        padding: 2px 8px;
        font-size: var(--font-size-2xs);
    }

    .compact .count {
        font-size: 0.65rem;
        padding: 0 4px;
    }
</style>
